{%- if include.id -%}
  {%- assign gallery = page[include.id] -%}
  {%- assign galleryName = include.id -%}
{%- elsif include.folder -%}
  {%- assign gallery = site.static_files | where_exp:"item", "item.path contains include.folder" -%}
  {%- assign galleryName = 'image-gallery' -%}
{%- else -%}
  {%- assign gallery = page.gallery -%}
  {%- assign galleryName = 'image-gallery' -%}
{%- endif -%}

{%- if include.reverse == "true" -%}
  {%- assign gallery = gallery | reverse -%}
{%- endif -%}

{%- if include.layout -%}
  {% assign gallery_layout = include.layout %}
{%- else -%}
  {%- if gallery.size == 2 -%}
    {% assign gallery_layout = 'half' %}
  {%- elsif gallery.size >= 3 -%}
    {% assign gallery_layout = 'third' %}
  {%- else -%}
    {% assign gallery_layout = '' %}
  {%- endif -%}
{%- endif -%}

{%- if gallery_layout == 'half' -%}
  {%- assign element_class = 'w-full sm:w-1/2' -%}
{%- elsif gallery_layout == 'third' -%}
  {%- assign element_class = 'w-full sm:w-1/2 md:w-1/3' -%}
{%- elsif gallery_layout == 'quarter' -%}
  {%- assign element_class = 'w-full sm:w-1/2 md:w-1/3 lg:w-1/4' -%}
{%- else -%}
  {%- assign element_class = 'w-full' -%}
{%- endif -%}

{%- if include.equal_height -%}
  {%- assign element_class = element_class | append: ' h-64 cover-img' -%}
{%- endif -%}

<figure class="flex flex-wrap {{galleryName}}">
  {% for img in gallery %}
      {%- assign file_path = img.image_path | default: img.path | relative_url -%}
      <a href="{{ file_path }}" class="flex-none p-1.5 {{ element_class }}">
        {% cloudinary thumbnail {{ file_path }} class="thumbnail" %}
      </a>
  {% endfor %}
  {% if include.caption %}
    <figcaption>{{ include.caption | markdownify | remove: "<p>" | remove: "</p>" }}</figcaption>
  {% endif %}
</figure>

<script>
    new SimpleLightbox({elements: '.{{galleryName}} a'});
</script>